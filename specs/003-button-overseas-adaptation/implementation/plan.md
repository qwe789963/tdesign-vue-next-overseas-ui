# Button 按钮组件海外适配 实施计划

> **规范引用**: 本实施计划遵循 `../../../.codebuddy/.rules/team-rule.md` 中的规范要求

## 元信息

| 属性 | 值 |
|------|-----|
| 功能名称 | button-overseas-adaptation |
| 规格版本 | 0.1.0 |
| 计划版本 | 0.1.0 |
| 创建日期 | 2026-02-11 |
| 预计完成 | 2026-02-13 |
| 规格文档 | `../spec.md` |

## 实施概览

### 目标
将 TDesign Vue2 版本的海外 Button 组件样式完整迁移到 Vue3 版本，确保所有变体、主题色、尺寸、形状和交互状态的样式与 Vue2 版本 100% 一致。

### 范围
- **包含**:
  - 创建海外样式目录结构 (`style/overseas/`)
  - 迁移 CSS 变量定义 (`_var.less`)
  - 迁移样式 mixin (`_mixin.less`)
  - 迁移按钮样式 (`_button.less`)
  - 更新样式入口文件 (`style/index.js`)
  - 删除交互示例面板 (`_usage/`)
  - 验收测试和文档更新

- **不包含**:
  - 修改 Button 组件的 TSX 逻辑
  - 修改组件的功能行为
  - 新增任何功能特性
  - 优化或改进现有样式

## 技术上下文

### 现有技术栈
| 技术 | 版本 | 用途 |
|------|------|------|
| Vue | >= 3.1.0 | 前端框架 |
| LESS | 预处理器 | 样式编译 |
| Vite | 构建工具 | 开发服务器和构建 |
| pnpm | 包管理器 | 依赖管理 |

### 相关代码位置
| 类型 | Vue2 路径 | Vue3 路径 |
|------|-----------|-----------|
| 样式变量 | `s2-overseas-ui/packages/overseas/src/button/style/_var.less` | `tdesign-vue-next-overseas-ui/packages/components/button/style/overseas/_var.less` (待创建) |
| 按钮样式 | `s2-overseas-ui/packages/overseas/src/button/style/_button.less` | `tdesign-vue-next-overseas-ui/packages/components/button/style/overseas/_button.less` (待创建) |
| Mixin | `s2-overseas-ui/packages/overseas/src/button/style/_mixin.less` | `tdesign-vue-next-overseas-ui/packages/components/button/style/overseas/_mixin.less` (待创建) |
| 主样式 | `s2-overseas-ui/packages/overseas/src/button/style/index.less` | `tdesign-vue-next-overseas-ui/packages/components/button/style/overseas/index.less` (待创建) |
| 样式入口 | - | `tdesign-vue-next-overseas-ui/packages/components/button/style/index.js` (待修改) |

### 依赖关系
| 依赖项 | 类型 | 路径 | 说明 |
|--------|------|------|------|
| 基础样式 | 内部 | `overseas/style/base.less` | 提供全局基础样式 |
| 基础 Token | 内部 | `overseas/style/` | 提供颜色、尺寸、边框等基础 Token |
| Reset Mixin | 内部 | `overseas/style/mixins/_reset.less` | 提供样式重置 |
| LESS 编译器 | 外部 | Vite LESS 插件 | 编译 LESS 文件 |

### 技术约束
1. 不修改 TSX 组件逻辑，只修改样式文件
2. 样式变量命名必须与 Vue2 版本完全一致
3. 保持 100% 视觉一致性，不做任何优化或改进
4. 所有 CSS 变量引用的基础 Token 必须存在

### 已知技术风险
| 风险 | 影响 | 概率 | 缓解措施 |
|------|------|------|----------|
| 基础 Token 不存在或值不一致 | 高 | 中 | 阶段 0 对比 Vue2 和 Vue3 的基础 Token，补齐缺失变量 |
| TSX 生成的 className 与 Vue2 不一致 | 高 | 低 | 阶段 0 对比 DOM 结构，调整样式选择器 |
| Mixin 函数不可用 | 中 | 中 | 阶段 1 迁移 mixin 文件，确保函数可用 |
| 样式加载顺序错误 | 中 | 低 | 按 Vue2 加载顺序组织 `@import` 语句 |

## 阶段划分

### 阶段 0: 研究和准备 (0.5 Day)
**目标**: 对比 Vue2 和 Vue3 的代码结构，收集技术细节

**任务清单**:
- [ ] **T0.1**: 对比 Vue2 和 Vue3 的基础 Token
  - 检查 `@brand-color`、`@success-color` 等变量是否存在
  - 对比颜色值、尺寸值是否一致
  - 生成 Token 对比表 (`research.md`)
  
- [ ] **T0.2**: 对比 Button 组件的 DOM 结构和 className
  - 在 Vue2 和 Vue3 中渲染相同配置的按钮
  - 检查生成的 className 是否一致 (如 `t-button--variant-base`)
  - 记录差异点
  
- [ ] **T0.3**: 检查 Mixin 和工具函数
  - 分析 Vue2 的 `_mixin.less` 中定义的函数 (如 `.button-size()`)
  - 确认 Vue3 中是否有对应的 mixin
  - 确定是否需要迁移
  
- [ ] **T0.4**: 确认样式加载机制
  - 检查 Vue3 的 `style/index.js` 的当前实现
  - 确认如何切换到海外样式
  - 确定样式文件的加载顺序

**交付物**:
- `research.md`: 技术调研报告，包含 Token 对比表、DOM 结构对比、Mixin 分析

**验收标准**:
- 所有基础 Token 已对比，缺失的 Token 已记录
- DOM 结构和 className 的差异已明确
- Mixin 迁移策略已确定
- 样式加载机制已理解

---

### 阶段 1: 样式文件迁移 (1 Day)
**目标**: 创建海外样式目录，迁移所有样式文件

**任务清单**:
- [ ] **T1.1**: 创建海外样式目录结构
  ```bash
  mkdir -p packages/components/button/style/overseas
  ```
  
- [ ] **T1.2**: 迁移 `_var.less` (CSS 变量定义)
  - 复制 Vue2 的 `_var.less` 到 Vue3 `overseas/` 目录
  - 确认所有引用的基础 Token 存在
  - 如有缺失 Token，添加补充定义或调整引用
  
- [ ] **T1.3**: 迁移 `_mixin.less` (样式 mixin)
  - 复制 Vue2 的 `_mixin.less` 到 Vue3 `overseas/` 目录
  - 确认 mixin 函数语法兼容
  - 测试 mixin 函数可正常调用
  
- [ ] **T1.4**: 迁移 `_button.less` (按钮样式)
  - 复制 Vue2 的 `_button.less` 到 Vue3 `overseas/` 目录
  - 确认选择器与 Vue3 生成的 className 匹配
  - 调整不一致的选择器 (如有)
  
- [ ] **T1.5**: 创建 `index.less` (主样式文件)
  - 创建样式入口文件
  - 按正确顺序导入: base.less → _var.less → _mixin.less → _button.less
  - 确认导入路径正确
  
- [ ] **T1.6**: 更新 `style/index.js`
  - 修改样式入口，从 TDesign 通用样式切换到海外样式
  - 确认样式加载顺序正确

**交付物**:
- `style/overseas/_var.less`: CSS 变量定义
- `style/overseas/_mixin.less`: 样式 mixin
- `style/overseas/_button.less`: 按钮样式
- `style/overseas/index.less`: 主样式文件
- `style/index.js`: 更新后的样式入口

**验收标准**:
- 所有样式文件已创建并放置在正确位置
- 样式文件可以被正确编译（无 LESS 语法错误）
- 样式入口已切换到海外样式
- 本地开发服务器可以正常启动并加载样式

---

### 阶段 2: 样式验证和调整 (1 Day)
**目标**: 验证样式效果，确保与 Vue2 版本一致

**任务清单**:
- [ ] **T2.1**: 基础变体验证
  - 渲染 base、outline、dashed、text 四种变体
  - 对比 Vue2 和 Vue3 的渲染效果
  - 调整不一致的样式
  
- [ ] **T2.2**: 主题色验证
  - 渲染 default、primary、success、warning、danger 五种主题色
  - 对比每种主题色在不同变体下的表现
  - 调整颜色值差异
  
- [ ] **T2.3**: 尺寸验证
  - 渲染 xs、s、m、l 四种尺寸
  - 测量高度、宽度、圆角、字号、内边距
  - 调整尺寸差异
  
- [ ] **T2.4**: 形状验证
  - 渲染 circle、round、square 三种形状
  - 对比圆角和尺寸
  - 调整形状样式
  
- [ ] **T2.5**: 交互状态验证
  - 测试 hover、active、disabled、loading 状态
  - 对比颜色变化和视觉效果
  - 调整交互状态样式
  
- [ ] **T2.6**: Ghost 模式验证
  - 在深色背景上渲染 ghost 按钮
  - 测试不同主题色的 ghost 按钮
  - 对比透明度和颜色
  - 调整 ghost 模式样式
  
- [ ] **T2.7**: 图标按钮验证
  - 渲染带前置图标、后置图标、纯图标的按钮
  - 检查图标尺寸和间距
  - 调整图标样式

**交付物**:
- 样式调整记录文档
- 验收测试报告

**验收标准**:
- 所有变体的样式与 Vue2 完全一致
- 所有主题色的颜色值与 Vue2 完全一致
- 所有尺寸的样式属性与 Vue2 完全一致
- 所有形状的样式与 Vue2 完全一致
- 所有交互状态的样式与 Vue2 完全一致
- Ghost 模式的样式与 Vue2 完全一致
- 图标按钮的样式与 Vue2 完全一致

---

### 阶段 3: 文档优化和清理 (0.5 Day)
**目标**: 删除交互示例面板，更新文档

**任务清单**:
- [ ] **T3.1**: 删除交互示例面板
  ```bash
  git rm -r packages/components/button/_usage
  ```
  
- [ ] **T3.2**: 验证文档页面
  - 确认交互示例面板已隐藏
  - 确认 Demo 标签页的示例仍然完整
  - 确认 API 文档仍然完整
  
- [ ] **T3.3**: 更新 CHANGELOG
  - 记录海外适配的变更内容
  - 说明删除交互示例面板的原因
  
- [ ] **T3.4**: 创建实施总结报告
  - 总结实施过程中的关键步骤
  - 记录遇到的问题和解决方案
  - 提供样式对比截图

**交付物**:
- 删除 `_usage/` 目录
- 更新 CHANGELOG
- 实施总结报告

**验收标准**:
- 交互示例面板已删除
- 文档页面正常显示
- CHANGELOG 已更新
- 实施总结报告已完成

---

## 技术决策

### 决策 1: 样式迁移策略 - 完全复制 vs. 重新实现
**背景**: 需要确定将 Vue2 样式迁移到 Vue3 的具体方式

**选项**:
1. **完全复制**: 将 Vue2 的样式文件完整复制到 Vue3，仅调整不兼容的部分
2. **重新实现**: 参考 Vue2 样式，在 Vue3 中从头编写样式代码
3. **选择性复制**: 只复制关键部分，其他部分使用 Vue3 的样式

**决定**: 选择选项 1 - **完全复制**

**理由**:
- 确保 100% 视觉一致性，降低人为错误
- 减少开发时间，提高效率
- 变量命名保持一致，便于后续维护
- 风险最低，只需要调整少量不兼容的代码

---

### 决策 2: 基础 Token 缺失处理
**背景**: Vue2 的样式文件引用了大量基础 Token（如 `@brand-color`），如果 Vue3 中不存在这些 Token，样式会编译失败

**选项**:
1. **补充定义**: 在 Vue3 的海外样式目录中补充缺失的 Token 定义
2. **修改引用**: 将 Vue2 样式中的 Token 引用替换为 Vue3 中存在的 Token
3. **要求上游**: 要求 Vue3 的基础样式系统补齐 Token

**决定**: 选择选项 1 + 选项 2 - **补充定义 + 修改引用**

**理由**:
- 选项 3 需要修改基础样式系统，影响范围大，不符合当前实施范围
- 选项 1 可快速解决缺失 Token 的问题，但会增加维护成本
- 选项 2 可确保与 Vue3 基础样式系统的一致性
- **组合使用**: 对于少量缺失的 Token，优先修改引用；如果大量缺失，则在海外样式中补充定义

---

### 决策 3: Mixin 迁移策略
**背景**: Vue2 的 `_mixin.less` 中定义了样式 mixin 函数（如 `.button-size()`），需要确定是否迁移

**选项**:
1. **完整迁移**: 将 Vue2 的所有 mixin 函数迁移到 Vue3
2. **按需迁移**: 只迁移 Button 样式中使用到的 mixin 函数
3. **用 CSS 变量替代**: 不使用 mixin，改用 CSS 变量实现

**决定**: 选择选项 1 - **完整迁移**

**理由**:
- 保持与 Vue2 代码结构的一致性
- Mixin 函数可能在未来的组件中被复用
- 迁移成本低，且不影响功能
- 如果只迁移部分 mixin，可能导致代码不完整

---

### 决策 4: 样式入口修改方式
**背景**: 需要将 `style/index.js` 从 TDesign 通用样式切换到海外样式

**选项**:
1. **直接替换导入路径**: 将导入路径从 `'./index.less'` 改为 `'./overseas/index.less'`
2. **条件导入**: 根据环境变量或配置判断导入哪个样式
3. **创建新的入口文件**: 创建 `style/index-overseas.js`，保留原有入口

**决定**: 选择选项 1 - **直接替换导入路径**

**理由**:
- 符合当前需求：完全切换到海外样式
- 实现简单，不引入额外复杂度
- 与 Checkbox 组件的实现方式保持一致
- 如果未来需要条件导入，可以在此基础上扩展

---

## 风险管理

| 风险 | 影响 | 概率 | 缓解措施 | 负责人 | 状态 |
|------|------|------|----------|--------|------|
| **R1**: 基础 Token 大量缺失 | 高 | 中 | 阶段 0 进行完整对比，提前补充定义 | 开发人员 | 待评估 |
| **R2**: TSX 生成的 className 不一致 | 高 | 低 | 阶段 0 对比 DOM 结构，调整样式选择器 | 开发人员 | 待评估 |
| **R3**: Mixin 函数语法不兼容 | 中 | 中 | 阶段 1 测试 mixin 编译，调整语法 | 开发人员 | 待评估 |
| **R4**: 样式加载顺序错误导致样式覆盖 | 中 | 低 | 按 Vue2 的加载顺序组织 `@import` | 开发人员 | 待评估 |
| **R5**: 视觉效果细微差异难以发现 | 中 | 中 | 阶段 2 使用视觉对比工具（截图对比） | 开发人员 | 待评估 |
| **R6**: 浏览器兼容性问题 | 低 | 低 | 使用标准 CSS 属性，避免实验性特性 | 开发人员 | 待评估 |

---

## 资源需求

### 人力资源
- **开发人员**: 3 人天
  - 阶段 0: 0.5 人天
  - 阶段 1: 1 人天
  - 阶段 2: 1 人天
  - 阶段 3: 0.5 人天
  
- **测试人员**: 0.5 人天（可由开发人员兼任）
  - 阶段 2: 样式验证测试
  
- **设计师**: 0.5 人天（可选，用于视觉验收）
  - 阶段 2: 视觉对比和确认

### 技术资源
- **开发环境**: 本地开发环境（已具备）
- **浏览器**: Chrome、Firefox、Safari、Edge（用于兼容性测试）
- **工具**: 
  - VS Code（代码编辑）
  - Chrome DevTools（样式调试）
  - 视觉对比工具（截图对比，可选）

### 外部依赖
- **Vue2 项目访问权限**: 需要访问 `s2-overseas-ui` 项目以查看源码
- **LESS 编译器**: Vite 内置 LESS 插件（已具备）

---

## 里程碑

| 里程碑 | 日期 | 交付物 | 验收标准 | 状态 |
|--------|------|--------|----------|------|
| **M0**: 研究完成 | Day 0.5 | `research.md` | Token 对比表、DOM 结构分析完成 | 待开始 |
| **M1**: 样式文件迁移完成 | Day 1.5 | 所有样式文件 | 样式可编译，本地服务器正常运行 | 待开始 |
| **M2**: 样式验证完成 | Day 2.5 | 验收测试报告 | 所有验收场景通过 | 待开始 |
| **M3**: 文档优化完成 | Day 3 | 删除 `_usage/`，更新 CHANGELOG | 交互示例面板已删除，文档正常 | 待开始 |
| **M4**: 功能上线 | Day 3 | 合并到主分支 | 代码审查通过，CI/CD 流水线通过 | 待开始 |

---

## 质量保证

### 代码审查检查项
- [ ] 样式文件结构符合规范
- [ ] CSS 变量命名与 Vue2 一致
- [ ] 样式选择器正确匹配 TSX 生成的 className
- [ ] 样式文件无 LESS 语法错误
- [ ] 样式入口修改正确

### 测试策略
1. **单元测试**: 无（样式迁移无需单元测试）
2. **视觉测试**: 手动对比 Vue2 和 Vue3 的渲染效果
3. **兼容性测试**: 在 Chrome、Firefox、Safari、Edge 上测试
4. **回归测试**: 确保现有功能不受影响

### 验收标准
- 所有功能需求（FR-001 ~ FR-012）的验收标准全部通过
- 所有非功能需求（NFR-001 ~ NFR-004）的要求全部满足
- 所有验收测试场景（场景 1 ~ 场景 8）全部通过
- 代码审查通过
- CI/CD 流水线通过

---

## 实施后续

### 监控和维护
- 监控用户反馈，收集样式问题
- 定期同步 Vue2 版本的样式更新
- 跟踪浏览器兼容性变化

### 文档更新
- 更新组件文档，说明海外适配已完成
- 更新 CHANGELOG，记录样式变更
- 创建维护指南，说明如何同步 Vue2 样式更新

### 未来优化
- 考虑提取海外样式系统为独立包
- 考虑自动化 Vue2 到 Vue3 的样式同步工具
- 考虑建立视觉回归测试系统

---

## 变更历史

| 版本 | 日期 | 变更说明 | 作者 |
|------|------|----------|------|
| 0.1.0 | 2026-02-11 | 初始版本 - 创建实施计划 | AI Assistant |
